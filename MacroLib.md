# Описание #

> Плагин предназначен для управления макросами FAR, хранимыми в текстовом формате.

> Плагин использует собственный формат файла - [FML (Far Macro Library)](FML.md). В одном FML файле может быть записано произвольное количество макросов. При запуске плагин ищет все FML файлы в заданном каталоге (по умолчанию - подкаталог Macros в каталоге плагина). Если макросу назначена горячая клавиша, то он будет вызван автоматически при ее нажатии. Макросы, которым не назначена горячая клавиша, можно вызывать через меню плагина. Если на одну горячую клавишу назначено несколько макросов, то при ее нажатии будет предложено выбрать один из них.

> Обсуждение:<br>
<blockquote><a href='http://forum.farmanager.com/viewtopic.php?f=5&t=5994'>http://forum.farmanager.com/viewtopic.php?f=5&amp;t=5994</a></blockquote>

<blockquote>Репозиторий FML макросов:<br>
<a href='http://code.google.com/p/far-macro-library/'>http://code.google.com/p/far-macro-library/</a></blockquote>

<h2>Загрузить</h2>

<ul><li><a href='http://plugring.farmanager.com/plugin.php?pid=844'>Последняя версия</a></li></ul>

<ul><li><a href='http://code.google.com/p/far-plugins/downloads/list?q=MacroLib&can=1'>Старые версии</a></li></ul>


<h2>Пример</h2>

<img src='http://far-plugins.googlecode.com/svn/trunk/MacroLib/Image/Sample.png' />

<hr />

<h1>История изменений</h1>

<h2>Ver 1.26</h2>

<ul><li>Адаптация под новые билды FAR</li></ul>

<ul><li>Усовершенствована обработка кнопок с привязкой типа AltX:Release/Up. Теперь макросы должны срабатывать независимо от того что отпущено раньше: префиксная или значащая кнопка</li></ul>

<h2>Ver 1.25</h2>

<ul><li>При запуске нативных LUA макросов поддерживаются все флаги/условия</li></ul>

<ul><li>Исправление ошибок</li></ul>


<h2>Ver 1.24</h2>

<ul><li>Для поддержки нативных LUA макросов больше не нужен макрос-хелпер</li></ul>

<ul><li>Нативные LUA макросы можно запускать из списка макросов</li></ul>

<ul><li>Экспериментальный режим: MacroLib расширяет возможности клавиатурной привязки нативных LUA макросов. Можно использовать все модификаторы нажатий, которые доступны в FML-макросах:</li></ul>

<blockquote>Release, Hold, Single, Double, Down, Up и Press (обычное нажатие)</blockquote>

<blockquote>Модификаторы можно использовать и для регулярных выражений:<br>
<pre><code>key="/Alt\\d/:Hold"<br>
</code></pre></blockquote>

<blockquote>Обратите внимание, что при этом регулярные выражения будут работать по правилам принятым в FML макросах, т.е. перед ними не надо писать "<code>[LR]</code>"</blockquote>

<blockquote>MacroLib обрабатывает <i>только</i> макросы имеющие расширенную привязку, обычная привязка обрабатывается самим FAR. Так как обработка нажатий FAR'ом имеет приоритет над плагинами, то нельзя на одно нажатие повесить два макроса с обычной и расширенной привязкой - расширенная не сработает. Для разрешения этого конфликта используйте модификатор Press, который означает "обычное нажатие".</blockquote>

<blockquote>Эта фича по умолчанию выключена, включается в меню настроек:<br>
<pre><code>[x] Расширять привязку клавиш FAR<br>
</code></pre></blockquote>

<h2>Ver 1.23</h2>

<ul><li>Исправление ошибок</li></ul>

<h2>Ver 1.22</h2>

<ul><li>Возможно обновление LUA макросов из модального редактора, вызванного из списка макросов (макрос на F9).</li></ul>

<ul><li>Команда перехода из списка макросов к макрофайлу (Ctrl+PgDn)</li></ul>

<ul><li>Настройка цветов</li></ul>

<ul><li>Исправление ошибок</li></ul>


<h2>Ver 1.21</h2>

<ul><li>Список макросов отображает FML макросы и нативные LUA макросы/события (если вызов списка производится через специальный макрос-хелпер)</li></ul>

<ul><li>В списке макросов часть макросов может быть скрыта. Скрытыми считаются макросы не имеющие описания, или если их описание начинается с точки. Показать скрытые макросы - Ctrl-H.</li></ul>

<ul><li>В списке макросов добавлены заголовки столбцов. Клик на заголовке - упорядочивает по столбцу.</li></ul>

<ul><li>Расширенные команды Plugin.Call. Подробности - в readme.txt.</li></ul>

<ul><li>При установленном плагине FarHints ошибка компиляции макросов может показываться в неблокирующем режиме (см. макрос "Update macroses")</li></ul>

<ul><li>Запуск новых макросов не блокируется во время исполнения предыдущего макроса (но блокируется во время записи).</li></ul>


<h2>Ver 1.20</h2>

<ul><li>Добавлена возможность вложения макросов друг в друга, с помощью директив: <code>#include_macro</code> и <code>#include_macro_once</code>
</li></ul><blockquote>Допустимо только однократное вложение.</blockquote>

<ul><li>Исправление ошибок</li></ul>

<h2>Ver 1.19</h2>

<ul><li>Far3 build 2851+ (LUA)<br>
</li><li>Расширение макрофайлов теперь - fmlua<br>
</li><li>Добавлены однострочные комментарии в стиле LUA (начинающиеся с "--") Внутри макропоследовательности комментарии специально не разбираются, поэтому можно использовать <i>только</i> комментарии LUA.</li></ul>



<h2>Ver 1.0.17</h2>

<ul><li>Поддержка регулярных выражений в привязке клавиш (только для Far3). Теперь вместо:<br>
<pre><code>Keys="Alt1 Alt2 Alt3 Alt4 Alt5 Alt6 Alt7 Alt8 Alt9 Alt0"<br>
</code></pre>
</li></ul><blockquote>можно писать:<br>
<pre><code>Keys="/Alt\d/"<br>
</code></pre>
Замечания:<br>
<ol><li>Регулярные выражения допустимы только в макросах, описанных с помощью ключевого слова Macro<br>
</li><li>Регулярное выражение отличается от обычного имени клавиши тем, что оно окружается символом "/" (слэш), если вам надо повесить макрос на данную клавишу, используйте привязку вида: Key="/\//"<br>
</li><li>Регулярное выражение регистро-нечувствительное, добавлять "i" не надо.<br>
</li><li>Привязка по регулярным выражениям поддерживает модификаторы нажатий, они должны записываться после закрывающего слэша:<br>
<pre><code>Keys="/Alt\d/:Up"<br>
</code></pre>
</li><li>В одной строке можно указывать несколько привязок по регулярным выражениям и без, в произвольном порядке:<br>
<pre><code>Keys="/Alt\d/ Alt- Alt="<br>
</code></pre></li></ol></blockquote>

<ul><li>Условие срабатывания Selected работает и в диалогах</li></ul>


<h2>Ver 1.0.15</h2>

<ul><li>Far 3.0.2380+ (охтыжёбтвоюмать)</li></ul>

<h2>Ver 1.0.14</h2>

<ul><li>Поддержка новых версий Far3 (Far 3.0.2379+ )</li></ul>

<ul><li>Far 3: Новые макрообласти "DlgACompl" и "ShellACompl". Если указано просто "ACompl", то макрос работает в обоих областях, как и раньше.</li></ul>

<ul><li>Far 3: В связи с тем что ProcessConsoleInput пока не доделан, в плагин добавлена возможность обработки клавиатуры через injection, как в Far 2. Для включения этого режима включите опцию "Use Injection" в настройках плагина и перезагрузите FAR.</li></ul>

<h2>Ver 1.0.10 - 1.0.13</h2>

<ul><li>Поддержка Far 3</li></ul>

<ul><li>Поддержка нативного режима запуска макросов.</li></ul>

<blockquote>"Нативные" макросы должны начинаться с ключевого слова FarMacro - тогда MacroLib не будет их запускать самостоятельно, а добавит в списки Far (через MCTL_ADDMACRO), а Far уже запустит сам - как умеет.</blockquote>

<blockquote>Нативные макросы обладают рядом ограничений, по сравнению с MacroLib-овскими:<br>
<ol><li>Не работают модификаторы нажатий<br>
</li><li>Не работает запуск по событиям<br>
</li><li>Не работают приоритеты (пока нативные макросы обладают наивысшим приоритетом)<br>
</li><li>Не выдается список в случае конфликта (просто сработает первый)<br>
</li><li>Не работает макроподстановка #AKey - используйте функцию AKey()</li></ol></blockquote>

<blockquote>Привязка к нескольким кнопкам и областям (в том числе по GUID'ам или заголовкам) - работает.</blockquote>

<blockquote>Плюсы:<br>
<ol><li>Теоретически, такие макросы должны запускаться немного быстрее.<br>
</li><li>Их можно вызывать через Eval</li></ol></blockquote>

<h2>Ver 1.0.9</h2>

<ul><li>Новые модификаторы нажатий - Down и Up:</li></ul>

<blockquote>Down - Макрос срабатывает только при нажатии (без автоповтора)</blockquote>

<blockquote>Up   - Макрос срабатывает при отпускании. В отличии от Release     макрос срабатывает при отпускании префиксных клавиш, даже если были комбинированные нажатия</blockquote>


<h2>Ver 1.0.8</h2>

<ul><li>Требуется FAR Build 1800+</li></ul>

<ul><li>В макросах работают стандартные функции AKey()/$AKey. Макроподстановка #AKey оставлена, для совместимости.</li></ul>

<ul><li>Поддержка командных префиксов. Префикс по умолчанию "FML", настраивается в реестре (ключ CmdPrefix). Пока поддерживаются только команды Call и Key. Подробности - Readme.txt</li></ul>

<ul><li>Поддержка исполнения команд через CallPlugin. Синтаксис командной строки точно такой же, как через префикс (только не надо писать "FML:")<br>
</li></ul><blockquote>Пример:</blockquote>

<blockquote>CallPlugin(MacroLib, "call Hello")</blockquote>

<blockquote>Примечание: Хотя вызов макроса из макроса через CallPlugin похож на вызов макрофункций через Eval, он обладает существенно отличным поведением в связи с особенностями реализации: исполнение текущего макроса прекращается и начинает исполняться вызванный макрос, эту особенность необходимо учитывать при использовании данной функции.</blockquote>

<ul><li>Исправлено несколько ошибок.</li></ul>


<h2>Ver 1.0.7</h2>

<ul><li>Приоритет макроса. Если под условия срабатывания попало сразу несколько макросов, то будет исполнен макрос, обладающий наибольшим приоритетом. Если имеется несколько макросов с одинаковым приоритетом, то будет показан диалог со списком макросов и предложено выбрать один из них.</li></ul>

<ul><li>Правила срабатывания макросов, назначенных на буквенные клавиши приведены в соответствие со стандартом в FAR: макрос назначенный на "Z" срабатывает при нажатии на "z", "ShiftZ", "я" и "ShiftЯ", при этом макроподстановка #AKey вернет код символа: "z", "Z", "я", "Я" соответственно.</li></ul>

<ul><li>Возможность привязки макросов в области Editor/Viewer к определенному типу файлов, по маске. Подробности в Readme.txt.</li></ul>

<ul><li>В списке макросов, в колонке с кнопками отображаются модификаторы нажатий.</li></ul>

<ul><li>Исправлено несколько ошибок</li></ul>


<h2>Ver 1.0.6</h2>

<ul><li>Возможность привязки макросов к конкретному диалогу по Caption. Полезно, пока не все диалоги снабжены GUID'ами.</li></ul>

<ul><li>Возможность привязки макросов к одинарному/двойному нажатию клавиши или кнопки мыши, или удержании кнопки в течении тайм-аута. В сумме это дает возможность назначить на одну кнопку до 4-х макросов  :)<br>
</li></ul><blockquote>Подробности - Readme.txt</blockquote>

<ul><li>Обработка клавиатуры и мыши автоматически отключается на время записи и проигрывания макросов.</li></ul>


<h2>Ver 1.0.5</h2>

<ul><li>Альтернативный способ запуска макросов - по событию. В текущей версии поддерживается только один тип события "Open". Если это событие назначено для области Shell, то макрос исполняется один раз при запуске FAR. Если событие назначено для областей Editor, Viewer или Dialog то макрос исполняется каждый раз при открытии соответствующего окна. Для других областей событие игнорируется.</li></ul>

<ul><li>Новые команды в списке макросов:<br>
<ul><li>Alt-F4 - Открывает макрос в модальном текстовом редакторе<br>
</li><li>F5     - Обновляет макросы (работает только в полном списке макросов)</li></ul></li></ul>

<ul><li>В списке макросов показываются подсказки (требуется плагин FarHints)</li></ul>

<h2>Ver 1.0.4</h2>

<ul><li>В списке макросов возможна фильтрация и упорядочиванию по любому столбцу, Ctrl-2/3/4 циклически переключают режимы отображения столбцов.<br>
</li></ul><blockquote>Подробности в хелпе (F1)</blockquote>

<ul><li>Для задания некоторых макрообластей используются сокращенный наименования (длинные имена оставлены в качестве синонимов)</li></ul>

<ul><li>Исправлен ряд ошибок</li></ul>

<h2>Ver 1.0.3</h2>

<ul><li>Описания констант в FML файле. Константы можно использовать при указании макрообластей и в тексте макропоследовательности.</li></ul>

<ul><li>Include в FML файлах. Можно подключать файлы с описанием констант, например. Также поддерживается #Include в тексте макропоследовательности, таким образом можно включать "plain-text" макросы или макросы от плагина SelMacro.</li></ul>

<ul><li>Макроподстановка #AKey, для замены неработающих $AKey и AKey() см. пример - AltScreens.fml</li></ul>

<ul><li>Возможно назначение макросов на однократное нажатие префиксных клавиш Ctrl/Alt/Shift. Обратите внимание: чтобы поведение таких макросов было аналогично стандартному поведению в FAR (макрос срабатывает при <i>отпускании</i> префиксной клавиши) необходимо явно указать параметр: RunOnRelease=1</li></ul>

<ul><li>Изменено поведение при обработке правых и левых префиксных клавиш:<br>
<ol><li>Если макрос назначен на CtrlX то он сработает при нажатии на CtrlX и при нажатии на RCtrlX<br>
</li><li>Если макрос назначен на RCtrlX то он сработает только при нажатии RCtrlX<br>
</li><li>Если два макроса назначены на CtrlX и RCtrlX, то они будут срабатывать только при нажатии соответствующей им клавиши.</li></ol></li></ul>

<blockquote>Назначение разных макросов на правые и левые префиксные клавиши дает возможность назначить в два раза больше макросов :)</blockquote>

<h2>Ver 1.0.2</h2>

<ul><li>Поддержаны все условия срабатывания макросов. Задаются с помощью параметра Condition. Подробности в Readme.txt</li></ul>

<ul><li>Возможность привязки макросов к конкретному диалогу по GUID.</li></ul>

<blockquote>Для демонстрации этой возможности в комплекте идет:<br>
макрос возвращающий поиску прежнее поведение (c) John Doe<br>
<a href='http://forum.farmanager.com/viewtopic.php?f=15&t=3392'>http://forum.farmanager.com/viewtopic.php?f=15&amp;t=3392</a></blockquote>

<ul><li>Исправленная схема для colorer'а